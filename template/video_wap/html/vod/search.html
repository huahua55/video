<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <title>{$param.wd}{$param.actor}{$param.director}{$param.area}{$param.lang}{$param.year}{$param.class}搜索结果 - {$maccms.site_name}</title>
  <meta name="keywords" content="{$param.wd}{$param.actor}{$param.director}{$param.area}{$param.lang}{$param.year}{$param.class}搜索结果" />
  <meta name="description" content="{$param.wd}{$param.actor}{$param.director}{$param.area}{$param.lang}{$param.year}{$param.class}搜索结果" />
  {include file="public/header-include"}
  <link rel="stylesheet" href="{$maccms.path_tpl}static/css/search.css">
</head>

<body>
  <div class="container">
    <!-- 公共头部 -->
    {include file="public/header"}
    <!-- 公共头部 -->
    
    <!-- 搜索页面 主体content -->
    
    <!-- 搜索结果存在时展示以下内容 -->
    <div class="search-result">
      <div id="moduleList" class="search-show">
        {maccms:vod num="10" paging="yes" pageurl="vod/search" order="desc" by="time"}
        <a class="search-show-item" href="{:mac_url_vod_detail($vo)}">
          <div class="play-img">
            <img src="{:mac_url_img($vo.vod_pic)}" alt="{$vo.vod_name}">
            <div class="tips">
              <span>{if condition="$vo.vod_serial gt 0"}第{$vo.vod_serial}集/共{$vo.vod_total}集{else/}{$vo.vod_remarks}{/if}</span>
            </div>
          </div>
          <div class="play-text">
            <div class="title">{$vo.vod_name}</div>
            <div class="role">主演：{$vo.vod_actor}</div>
            <div class="director">导演：{$vo.vod_director}</div>
            <div class="type">类型：{$vo.type_name} / {$vo.vod_area} / {$vo.vod_year}</div>
            <div class="time">时间：{$vo.vod_time|date='Y-m-d',###}</div>
          </div>
        </a>
        {/maccms:vod}
      </div>
      <div class="load-more" style="display: none;">
        <a href="javascript:;" onclick="getMoreVod()">加载更多</a>
      </div>
      <!-- <div class="ui-bar list-page fn-clear">
        {include file="public/paging"}
      </div> -->
    </div>

    <!-- $__PAGING__.record_total必须在下方调用，尴尬，凑合实现 -->
    {if condition="$__PAGING__.record_total eq 0"}
    <!-- 搜索结果为空时展示以下内容 -->
    <div class="search-no">
      <div class="search-history">
        <div class="search-history-title">
          搜索历史
          <div id="clearHistory" class="img">
            <img src="{$maccms.path_tpl}static/image/search_delete.png" alt="清空历史">
          </div>
        </div>
        <div id="searchHistory" class="search-history-list">
          <!-- <a class="search-history-item" href="javascript:;">辩护人</a>
          <a class="search-history-item" href="javascript:;">屏息</a>
          <a class="search-history-item" href="javascript:;">我在故宫修文物</a> -->
        </div>
      </div>

      <div class="search-hot">
        <div class="search-hot-title">
          全网热搜
        </div>
        <div class="search-hot-list">
          {maccms:foreach name=":explode(',',$maccms.search_hot)" id="vo" key="key"}
          <a class="search-hot-item item{$key+1}" href="{:mac_url('vod/search',['wd'=>$vo])}">
            <i>{$key+1}</i>
            <span>{$vo}</span>
          </a>
          {/maccms:foreach}
        </div>
      </div>
    </div>

    {/if}

    <!-- 搜索页面 主体content -->
  </div>

  {include file="public/footer-include"}
  <script>
    var curKeyword = '{$param.wd}';
    var keywords = [];
    var searchHistory = localStorage.getItem('search_history');
    if(searchHistory && JSON.parse(searchHistory)){
      keywords = JSON.parse(searchHistory);
    }
    if(keywords.indexOf(curKeyword) === -1){
      keywords.push(curKeyword);
      localStorage.setItem('search_history', JSON.stringify(keywords));
    }

    var _HTML = '';
    $(keywords).each(function(){
      _HTML = _HTML + '<a class="search-history-item" href="./search.html?wd='+this+'">'+this+'</a>';
    })
    $('#searchHistory').html(_HTML);

    $('body').on('click', '#clearHistory', function(){
      $('#searchHistory').empty();
      localStorage.removeItem('search_history');
    });


    var nextPage = Number({$__PAGING__.page_next});
    var totalPage = Number({$__PAGING__.page_total});
    // console.log('共{$__PAGING__.record_total}条数据,当前{$__PAGING__.page_current}/{$__PAGING__.page_total}页,下一页{$__PAGING__.page_next}');
    $(function(){
      console.log(nextPage, Boolean(nextPage));
      if($('#moduleList a').length && nextPage>1){
        $('.load-more').show();
      }
    });

    function getMoreVod(){
      if(!nextPage || nextPage > totalPage){
        $('.load-more a').text('暂无更多数据');
        return;
      }
      $.ajax({
        url: '{$__PAGING__.page_url|mac_url_page=1}?page='+ nextPage +'&ajax=1',
        cache: false,
        success: function(html){
          nextPage += 1;
          // console.log('nextPage', nextPage);
          // console.log('totalPage', totalPage);
          $("#moduleList").append(html);
        }
      });
    }


  </script>
</body>

</html>