<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
  <title>会员注册 - {$maccms.site_name}</title>
  <meta name="keywords" content="{$maccms.site_keywords}" />
  <meta name="description" content="{$maccms.site_description}" />
  {include file="public/header-include"}
  <link rel="stylesheet" href="{$maccms.path_tpl}static/css/register.css">
</head>

<body>
  <div class="container">
    <!-- 注册 主体content -->
    <div class="register">
      <div class="register-header go-back">
        <div class="register-header-back"></div>
        <div class="register-header-title">
          账户注册
        </div>
        <div class="register-header-tool"></div>
      </div>
      <div class="register-header-space"></div>

      <div class="register-wrap">
        <form method="post" id="fm" action="">
          <div class="register-form-group">
            <div class="form-group clearfix">
              <!-- <h5>账号</h5> -->
              <img src="{$maccms.path_tpl}static/image/icon_account.png" alt="账号">
              <input type="text" name="user_name" placeholder="创建账户名（6-16个字符）">
            </div>
            {if condition="$user_config.reg_verify neq 0"}
            <div class="form-group clearfix">
              <img src="{$maccms.path_tpl}static/image/icon_code.png" alt="验证码">
              <input id="inputCode" type="text" name="verify" placeholder="请输入验证码">
              <!-- <div id="checkCode" class="check-code" onclick="createCode(4)"></div> -->
              <div id="checkCode" class="check-code pwd_img"><img id="verify_img" src="{:url('verify/index')}"
                  onClick="this.src=this.src+'?'+Math.random()" /></div>
            </div>
            {/if}
            <div class="form-group clearfix">
              <img src="{$maccms.path_tpl}static/image/icon_password.png" alt="密码">
              <input type="password" id="pass1" name="user_pwd" placeholder="密码6-16位字母 数字或者符号">
            </div>
            <div class="form-group clearfix">
              <img src="{$maccms.path_tpl}static/image/icon_password.png" alt="确认密码">

              <input type="password" id="pass2" name="user_pwd2" placeholder="确认密码">
            </div>
          </div>
          <!-- 注册提交前先调用validateCode()方法来校验验证码输入 -->
          <input type="button" id="btn_submit" class="btn-brand" value="注册">
        </form>
        <div class="register-agreement">
          注册即同意<a href="javascript:;">用户协议</a>
        </div>
      </div>


    </div>

    <!-- 注册 主体content -->

  </div>

  {include file="public/footer-include"}
  <script>
    $(".go-back").click(function () {
      var ref = document.referrer;
      location.href = ref;
    });

    $("#btn_submit").click(function () {
      var data = $('#fm').serialize();
      var input = $("#fm").serializeArray();
      var pass1 = $("#pass1").val();
      var pass2 = $("#pass2").val();
      var inputName = new Array();
      inputName['user_name'] = '账号';
      inputName['user_pwd'] = '密码';
      inputName['user_pwd2'] = '确认密码';
      inputName['user_email'] = '邮箱';
      inputName['verify'] = '验证码';

      var is = false;
      var err = '';
      $.each(input, function (name, field) {
        if (field.value == '' && field.name != 'verify') {
          is = true;
          err = inputName[field.name] + '不能为空';
          return false;
        }
      });
      if (is) {
        alert(err);
        return false;
      }
      if (pass1 != pass2) {
        alert('两次密码不一致');
        return false;
      }

      $.ajax({
        url: "{:url('user/reg')}",
        type: "post",
        dataType: "json",
        data: data,
        beforeSend: function () {
          //开启loading
          //$(".loading_box").css("display","block");
          $("#btn_submit").css("background", "#fd6a6a").val("loading...");
        },
        success: function (r) {
          alert(r.msg);
          if (r.code == 1) {
            location.href = "{:url('user/login')}";
          }
          else {
            $('#verify_img').click();
          }
        },
        complete: function () {
          //结束loading
          //$(".loading_box").css("display","none");
          $("#btn_submit").css("background", "#ff773c").val("登录");
        }
      });
    })
  </script>

</body>

</html>